---
import "../../styles/globals.css";
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import ColoredText from '../../components/ColoredText.astro';
import PartnerLink from '../../components/PartnerLink.astro';

// Function to format date as "Mar 3"
function formatDate(date: Date): string {
  const options: Intl.DateTimeFormatOptions = { month: 'short', day: 'numeric' };
  return date.toLocaleDateString('en-US', options);
}

// Function to calculate reading time
function getReadingTime(content: string): number {
  const wordsPerMinute = 200;
  const wordCount = content.split(/\s+/).length;
  return Math.ceil(wordCount / wordsPerMinute);
}

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const readingTime = getReadingTime(post.body);

// Define components to pass to the Content component
const components = {
  ColoredText,
  PartnerLink
};

// Get current URL for sharing
const currentUrl = Astro.url.href;
const encodedTitle = encodeURIComponent(post.data.title);
const encodedUrl = encodeURIComponent(currentUrl);
---

<Layout title={post.data.title}>
  <article class="blog-container mb-10">
    <div class="mb-6">
      <a href="/" class="inline-flex items-center text-gray-400 hover:text-gray-200 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to Home
      </a>
    </div>
    <h1 class="text-4xl font-bold mb-2">{post.data.title}</h1>
    <p class="text-gray-300 font-medium opacity-50 mb-4">{formatDate(post.data.date)} Â· {readingTime}min</p>
    <div class="prose">
      <Content components={components} />
    </div>
    
    <!-- Social Sharing CTA -->
    <div class="mt-16 pt-8 border-t border-gray-800">
      <div class="text-center">
        <h3 class="text-xl font-medium mb-4">Share this article</h3>
        <div class="flex justify-center space-x-5">
          <!-- Twitter/X Share -->
          <a href={`https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`} 
             target="_blank" 
             rel="noopener noreferrer"
             class="text-gray-400 hover:text-gray-200 transition-colors" 
             aria-label="Share on Twitter/X">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
            </svg>
          </a>
          
          <!-- LinkedIn Share -->
          <a href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`} 
             target="_blank" 
             rel="noopener noreferrer"
             class="text-gray-400 hover:text-gray-200 transition-colors" 
             aria-label="Share on LinkedIn">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
          
          <!-- Facebook Share -->
          <a href={`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`} 
             target="_blank" 
             rel="noopener noreferrer"
             class="text-gray-400 hover:text-gray-200 transition-colors" 
             aria-label="Share on Facebook">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a8.68 8.68 0 0 1 1.141.195v3.325a8.623 8.623 0 0 0-.653-.036 26.805 26.805 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.686 1.686 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647Z"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </article>
</Layout>